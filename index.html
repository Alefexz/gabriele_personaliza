<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja | Gabriele Personaliza</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* --- ESTILOS VISUAIS EXTRAS --- */
        
        /* 1. BARRA DE PESQUISA */
        .search-container {
            max-width: 600px;
            margin: -20px auto 30px; /* Posicionada entre o banner e os filtros */
            position: relative;
            padding: 0 20px;
        }
        .search-input {
            width: 100%;
            padding: 15px 20px;
            padding-left: 50px;
            border-radius: 50px;
            border: 1px solid #ddd;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: 0.3s;
            outline: none;
        }
        .search-input:focus { border-color: #B39DDB; box-shadow: 0 5px 20px rgba(179, 157, 219, 0.3); }
        .search-icon {
            position: absolute;
            left: 40px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1.2rem;
        }

        /* 2. BOTÃO FLUTUANTE DO WHATSAPP */
        .float-zap {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 25px;
            right: 25px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            animation: pulse-green 2s infinite;
        }
        .float-zap:hover { background-color: #128C7E; transform: scale(1.1); }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
        }

        /* 3. ANIMAÇÃO DE ENTRADA (FADE IN UP) */
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(30px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* ESTILOS ANTERIORES (MANTIDOS) */
        .hero-socials { display: flex; justify-content: center; gap: 20px; margin-top: 25px; margin-bottom: 10px; }
        .social-big { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-decoration: none; }
        .social-big:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .insta-bg { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
        .zap-bg { background: #25D366; }
        .modal-produto-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: end; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 20px 20px 0 0; padding: 25px; animation: slideUp 0.3s; position: relative; max-height: 90vh; overflow-y: auto; }
        @media(min-width: 768px) { .modal-produto-overlay { align-items: center; } .modal-content { border-radius: 20px; } }
        @keyframes slideUp { from {transform: translateY(100%)} to {transform: translateY(0)} }
        .modal-img-container { height: 250px; overflow: hidden; border-radius: 10px; margin-bottom: 15px; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; }
        .modal-img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; scroll-snap-align: center; }
        .modal-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: #333; margin-bottom: 5px; }
        .modal-price { font-size: 1.3rem; color: #B39DDB; font-weight: bold; margin-bottom: 15px; }
        .modal-desc { font-size: 0.9rem; color: #666; line-height: 1.6; margin-bottom: 20px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        .qtd-wrapper { margin-bottom: 20px; background: #f0f0f0; padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; }
        .qtd-controls { display: flex; align-items: center; gap: 10px; }
        .btn-qtd { width: 35px; height: 35px; background: #B39DDB; color: white; border: none; border-radius: 50%; font-weight: bold; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .qtd-display { font-size: 1.2rem; font-weight: bold; width: 30px; text-align: center; }
        .total-price { font-weight: bold; color: #333; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #555; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .termos-box { background: #FFF3E0; border: 1px solid #FFCC80; padding: 10px; border-radius: 8px; margin: 15px 0; display: flex; gap: 10px; align-items: flex-start; transition: 0.3s; }
        .termos-box input { margin-top: 5px; transform: scale(1.2); cursor: pointer; }
        .termos-text { font-size: 0.8rem; color: #E65100; line-height: 1.4; }
        .termos-text strong { font-weight: bold; text-decoration: underline; }
        .btn-comprar { background: #25D366; color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; display: flex; justify-content: center; gap: 10px; align-items: center; margin-top: 10px; }
        .btn-cartao { background: #009EE3; color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; display: none; justify-content: center; gap: 10px; align-items: center; text-decoration: none; margin-bottom: 10px; }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #aaa; }
        #custom-alert { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 5000; justify-content: center; align-items: center; }
        .alert-box { background: white; padding: 30px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .alert-icon { font-size: 3rem; color: #FFC107; margin-bottom: 15px; display: block; }
        .alert-title { font-size: 1.2rem; font-weight: bold; color: #333; margin-bottom: 10px; font-family: 'Playfair Display', serif; }
        .alert-msg { font-size: 0.9rem; color: #666; line-height: 1.5; margin-bottom: 20px; }
        .alert-btn { background: #B39DDB; color: white; border: none; padding: 12px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1rem; width: 100%; transition: 0.2s; }
        .alert-btn:hover { background: #9575CD; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        #modal-sucesso { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: center; text-align: center; }
        .sucesso-card { background: white; padding: 40px; border-radius: 20px; width: 90%; max-width: 400px; }
        .pedido-id { font-size: 1.5rem; font-weight: bold; color: #B39DDB; margin: 10px 0; letter-spacing: 2px; border: 2px dashed #B39DDB; padding: 10px; border-radius: 10px; display: inline-block; }
        .badge-promo { position: absolute; top: 10px; left: 10px; background: #E91E63; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); animation: pulse 2s infinite; }
        .original-price { text-decoration: line-through; color: #999; font-size: 0.9rem; margin-right: 5px; }
        .promo-price { color: #E91E63; font-weight: bold; font-size: 1.2rem; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .filter-btn[onclick*="promocao"] { background-color: #FCE4EC; color: #E91E63; border: 1px solid #F8BBD0; }
        .filter-btn[onclick*="promocao"].active { background-color: #E91E63; color: white; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="#" class="logo">Gabriele <span>Personaliza</span></a>
            <nav>
                <div class="menu-toggle"><i class="fas fa-bars"></i></div>
                <ul class="nav-links">
                    <li><a href="#loja" class="active">Loja</a></li>
                    <li><a href="#sobre">Sobre</a></li>
                    <li><a href="https://wa.me/559292770409" target="_blank" class="btn-nav">Falar no WhatsApp</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="welcome-banner">
        <div class="container">
            <h1>Seja bem-vindo(a)!</h1>
            <p>Transforme sua festa com nossa papelaria criativa feita à mão.</p>
            <div class="hero-socials">
                <a href="https://www.instagram.com/gabriele_personaliza/" target="_blank" class="social-big insta-bg"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/559292770409" target="_blank" class="social-big zap-bg"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="arrow-down"><i class="fas fa-chevron-down"></i></div>
        </div>
    </section>

    <section id="loja" class="section-padding store-section">
        <div class="container">
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="campo-busca" class="search-input" placeholder="O que você procura? (ex: Homem Aranha, Caderno...)" onkeyup="filtrarBusca()">
            </div>

            <div class="filter-container" style="flex-wrap: wrap; justify-content: center;">
                <button class="filter-btn active" onclick="carregarLoja('todos')">Todos</button>
                <button class="filter-btn" onclick="carregarLoja('promocao')"><i class="fas fa-tag"></i> Promoções</button>
                <button class="filter-btn" onclick="carregarLoja('festa')">Festas</button>
                <button class="filter-btn" onclick="carregarLoja('cadernos')">Cadernos</button>
                <button class="filter-btn" onclick="carregarLoja('mimos')">Mimos</button>
                <button class="filter-btn" onclick="carregarLoja('simples')">Simples</button>
                <button class="filter-btn" onclick="carregarLoja('semiluxo')">Semi Luxo</button>
            </div>
            
            <div class="product-grid" id="container-produtos">
                <p style="text-align:center; width:100%; grid-column: 1 / -1; padding: 40px; color: #888;">
                    <i class="fas fa-circle-notch fa-spin"></i> Carregando novidades...
                </p>
            </div>
        </div>
    </section>

    <section id="sobre" class="section-padding" style="background: #fff;">
        <div class="container about-container">
            <div class="about-text">
                <h2 class="section-title" style="text-align: left;">Quem faz?</h2>
                <p>A <strong>Gabriele Personaliza</strong> nasceu do desejo de transformar papel em memórias eternas. O que começou como um hobby criativo, hoje é uma marca dedicada a levar beleza e afeto para os seus momentos especiais.</p>
                <p style="margin-top: 15px;">Nosso atelier é especializado em <strong>papelaria criativa e personalizados para festas</strong>. Trabalhamos com design exclusivo, cortes precisos e montagem feita 100% à mão.</p>
            </div>
        </div>
    </section>

    <footer id="contato">
        <div class="container">
            <div class="footer-brand"><h3>Gabriele Personaliza</h3><p>Feito com amor.</p></div>
            <div class="socials">
                <a href="https://www.instagram.com/gabriele_personaliza/" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/559292770409" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="copyright">
                <p>&copy; 2026. <span id="btn-secreto" style="opacity: 0.3; cursor: pointer; font-weight: bold; margin-left: 5px;">G</span></p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/559292770409" target="_blank" class="float-zap">
        <i class="fab fa-whatsapp"></i>
    </a>

    <div id="modal-produto" class="modal-produto-overlay">
        <div class="modal-content">
            <i class="fas fa-times close-modal" onclick="fecharModal()"></i>
            <div id="modal-imagens" class="modal-img-container"></div>
            <h3 id="modal-titulo" class="modal-title">Nome</h3>
            <div id="modal-preco-container" class="modal-price">R$ 0,00</div>
            <div id="modal-descricao" class="modal-desc"></div>
            
            <div style="border-top: 1px solid #eee; padding-top: 20px;">
                <div class="qtd-wrapper">
                    <div class="qtd-controls">
                        <button class="btn-qtd" onclick="mudarQtd(-1)">-</button>
                        <span id="qtd-numero" class="qtd-display">1</span>
                        <button class="btn-qtd" onclick="mudarQtd(1)">+</button>
                    </div>
                    <div id="total-final" class="total-price">Total: R$ 0,00</div>
                </div>
                <div class="input-group">
                    <label>Seu Nome *</label><input type="text" id="cliente-nome" placeholder="Seu nome">
                </div>
                <div class="input-group">
                    <label>WhatsApp *</label><input type="tel" id="cliente-zap" placeholder="Seu número">
                </div>
                <div class="termos-box" id="box-termos">
                    <input type="checkbox" id="check-termos">
                    <div class="termos-text">Estou ciente do pagamento de <strong>50% de entrada</strong>.<br><span style="font-size:0.75rem;">* Valor não reembolsável em caso de desistência.</span></div>
                </div>
                <button id="btn-pagar-link" class="btn-cartao" onclick="pagarComCartao()"><i class="fas fa-credit-card"></i> Pagar com Cartão</button>
                <p id="divisor-pagamento" style="text-align:center; font-size:0.8rem; color:#888; margin:5px 0; display:none;">- OU -</p>
                <button class="btn-comprar" onclick="finalizarPedidoZap()"><i class="fab fa-whatsapp"></i> Pedir no WhatsApp</button>
            </div>
        </div>
    </div>

    <div id="custom-alert">
        <div class="alert-box">
            <i class="fas fa-exclamation-circle alert-icon"></i>
            <div class="alert-title">Atenção</div>
            <p class="alert-msg" id="msg-alerta">Mensagem</p>
            <button class="alert-btn" onclick="fecharAlerta()">Entendi</button>
        </div>
    </div>

    <div id="modal-sucesso">
        <div class="sucesso-card">
            <i class="fas fa-check-circle" style="font-size: 3rem; color: #2E7D32; margin-bottom: 20px;"></i>
            <h3>Pedido Iniciado!</h3>
            <div class="pedido-id" id="sucesso-id">#1234</div>
            <p style="margin-top:20px; font-size:0.9rem; color:#666">Envie este código no WhatsApp.</p>
            <button class="btn-comprar" onclick="fecharSucesso()" style="margin-top:20px"><i class="fab fa-whatsapp"></i> Enviar Comprovante</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBrRLiEFF8dfWHVxhK3popdYgEDQLiKzCM", authDomain: "gabriele-personaliza.firebaseapp.com", projectId: "gabriele-personaliza", storageBucket: "gabriele-personaliza.firebasestorage.app", messagingSenderId: "403724311605", appId: "1:403724311605:web:850e1bb14459a3ec60e57c", measurementId: "G-T24GYM57CT" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let produtoAtual = {}, qtdAtual = 1, minimoAtual = 1;
        const formatarMoeda = (valor) => parseFloat(valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        window.mostrarAlerta = (msg) => { document.getElementById('msg-alerta').innerText = msg; document.getElementById('custom-alert').style.display = 'flex'; }
        window.fecharAlerta = () => document.getElementById('custom-alert').style.display = 'none';

        // --- LÓGICA DE PESQUISA EM TEMPO REAL ---
        window.filtrarBusca = () => {
            const termo = document.getElementById('campo-busca').value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            
            cards.forEach(card => {
                const titulo = card.querySelector('h3').innerText.toLowerCase();
                // Verifica se o título contém o que foi digitado
                if(titulo.includes(termo)) {
                    card.style.display = 'flex'; // Mostra
                } else {
                    card.style.display = 'none'; // Esconde
                }
            });
        }

        window.carregarLoja = async (filtro = 'todos') => {
            const container = document.getElementById('container-produtos');
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().includes(filtro.replace('promocao','promoçõe')) || (filtro === 'todos' && btn.innerText === 'Todos')) btn.classList.add('active');
            });

            try {
                const q = await getDocs(collection(db, "produtos"));
                container.innerHTML = '';
                q.forEach(doc => {
                    const p = doc.data();
                    if (filtro === 'promocao') { if (!p.em_promocao || !p.ativo) return; } 
                    else if (filtro !== 'todos' && p.categoria !== filtro) { return; }
                    
                    let listaImagens = (p.fotos && p.fotos.length > 0) ? p.fotos : (p.foto ? [p.foto] : []);
                    let imagensHtml = '';
                    let estiloExtra = p.ativo ? '' : 'filter: grayscale(1); opacity: 0.6;';
                    if (listaImagens.length > 0) listaImagens.forEach((imgUrl, index) => imagensHtml += `<img src="${imgUrl}" class="carousel-img ${index===0?'active':''}" style="${estiloExtra}">`);
                    else imagensHtml = `<div class="carousel-img active" style="background:#E1BEE7;height:100%"></div>`;
                    
                    const minLabel = (p.minimo && p.minimo > 1) ? `<small style="display:block; color:#666; margin-top:5px">Mínimo: ${p.minimo} un</small>` : '';
                    let btnHtml = p.ativo ? `<button class="btn-sm" style="width:100%;border:none;background:#B39DDB;color:white;padding:8px;border-radius:5px;cursor:pointer;margin-top:5px;">Ver Detalhes</button>` : `<span style="color:red;font-size:0.8rem">Esgotado</span>`;
                    
                    let etiqueta = '';
                    if (!p.ativo) etiqueta = '<div class="badge-bestseller" style="background:#F44336;">Esgotado</div>';
                    else if (p.em_promocao && p.preco_promocional > 0) etiqueta = '<div class="badge-promo"><i class="fas fa-tag"></i> Oferta!</div>';

                    let priceHtml = formatarMoeda(p.preco);
                    if (p.ativo && p.em_promocao && p.preco_promocional > 0) priceHtml = `<span class="original-price">${formatarMoeda(p.preco)}</span> <span class="promo-price">${formatarMoeda(p.preco_promocional)}</span>`;

                    const card = document.createElement('div');
                    card.className = 'product-card fade-in-up'; // Adicionado animação aqui
                    card.innerHTML = `<div class="product-img-wrapper carousel-container">${etiqueta}${imagensHtml}</div><div class="product-info"><span class="category-tag">${p.categoria.toUpperCase()}</span><h3>${p.nome}</h3><div class="product-price">${priceHtml}</div>${minLabel}${btnHtml}</div>`;
                    if(p.ativo) card.onclick = () => abrirModal(p);
                    container.appendChild(card);
                });
                if(container.innerHTML === '') container.innerHTML = '<p style="text-align:center; padding:20px;">Nenhum produto encontrado.</p>';
                iniciarCarrossel();
            } catch(e) { console.error(e); }
        }

        function iniciarCarrossel() {
            if(window.carrosselInterval) clearInterval(window.carrosselInterval);
            window.carrosselInterval = setInterval(() => {
                document.querySelectorAll('.carousel-container').forEach(c => {
                    const imgs = c.querySelectorAll('.carousel-img');
                    if (imgs.length <= 1) return;
                    let active = 0;
                    imgs.forEach((img, i) => { if(img.classList.contains('active')) active = i; img.classList.remove('active'); });
                    imgs[(active + 1) % imgs.length].classList.add('active');
                });
            }, 3000);
        }

        window.abrirModal = (p) => {
            produtoAtual = p; minimoAtual = p.minimo || 1; qtdAtual = minimoAtual; 
            document.getElementById('modal-produto').style.display = 'flex';
            document.getElementById('modal-titulo').innerText = p.nome;
            let priceHtmlModal = formatarMoeda(p.preco);
            if (p.em_promocao && p.preco_promocional > 0) priceHtmlModal = `<span class="original-price">${formatarMoeda(p.preco)}</span> <span class="promo-price">${formatarMoeda(p.preco_promocional)}</span>`;
            document.getElementById('modal-preco-container').innerHTML = priceHtmlModal;
            document.getElementById('modal-descricao').innerText = p.descricao || "";
            document.getElementById('check-termos').checked = false; 
            document.getElementById('box-termos').style.border = "1px solid #FFCC80"; 
            const imgC = document.getElementById('modal-imagens'); imgC.innerHTML = '';
            (p.fotos || [p.foto]).forEach(f => { if(f) imgC.innerHTML += `<img src="${f}" class="modal-img">`; });
            atualizarUI();
        }

        window.mudarQtd = (delta) => {
            let novaQtd = qtdAtual + delta;
            if (novaQtd >= minimoAtual) { qtdAtual = novaQtd; atualizarUI(); }
        }

        function atualizarUI() {
            document.getElementById('qtd-numero').innerText = qtdAtual;
            let precoEfetivo = (produtoAtual.em_promocao && produtoAtual.preco_promocional > 0) ? produtoAtual.preco_promocional : produtoAtual.preco;
            let total = precoEfetivo * qtdAtual;
            document.getElementById('total-final').innerText = `Total: ${formatarMoeda(total)}`;
            const btnLink = document.getElementById('btn-pagar-link'); const div = document.getElementById('divisor-pagamento');
            if (produtoAtual.link_pagamento && produtoAtual.link_pagamento.length > 5 && qtdAtual === 1) { btnLink.style.display = 'flex'; div.style.display = 'block'; }
            else { btnLink.style.display = 'none'; div.style.display = 'none'; }
        }

        window.fecharModal = () => document.getElementById('modal-produto').style.display = 'none';

        function validarTermos() {
            const check = document.getElementById('check-termos');
            if(!check.checked) {
                mostrarAlerta("Para continuar, você precisa confirmar que concorda com a regra de 50% de entrada.");
                const box = document.getElementById('box-termos');
                box.style.border = "2px solid #F44336"; box.style.animation = "shake 0.5s";
                setTimeout(() => box.style.animation = "none", 500); return false;
            } return true;
        }

        async function registrarPedido(origem) {
            const nome = document.getElementById('cliente-nome').value;
            const zap = document.getElementById('cliente-zap').value;
            if(!nome || !zap) { mostrarAlerta("Por favor, preencha seu Nome e WhatsApp!"); return null; }
            const id = '#' + Math.random().toString(36).substr(2, 4).toUpperCase();
            try {
                let precoEfetivo = (produtoAtual.em_promocao && produtoAtual.preco_promocional > 0) ? produtoAtual.preco_promocional : produtoAtual.preco;
                let total = precoEfetivo * qtdAtual;
                await addDoc(collection(db, "pedidos"), { id_visual: id, cliente: nome, whatsapp: zap, produto: `${produtoAtual.nome} (x${qtdAtual})`, total: total, data: new Date().toISOString(), status: origem==='Cartão'?'Aguardando Pagamento':'Pendente', origem });
                return id;
            } catch(e) { mostrarAlerta("Erro: " + e.message); return null; }
        }

        window.pagarComCartao = async () => {
            if(!validarTermos()) return;
            const btn = document.getElementById('btn-pagar-link'); btn.innerText = "...";
            const id = await registrarPedido('Cartão');
            if(id) { window.open(produtoAtual.link_pagamento, '_blank'); fecharModal(); document.getElementById('sucesso-id').innerText = id; document.getElementById('modal-sucesso').style.display = 'flex'; }
            btn.innerHTML = '<i class="fas fa-credit-card"></i> Pagar com Cartão';
        }

        window.finalizarPedidoZap = async () => {
            if(!validarTermos()) return;
            const id = await registrarPedido('WhatsApp');
            if(id) {
                const nome = document.getElementById('cliente-nome').value;
                let precoEfetivo = (produtoAtual.em_promocao && produtoAtual.preco_promocional > 0) ? produtoAtual.preco_promocional : produtoAtual.preco;
                let total = precoEfetivo * qtdAtual;
                const msg = `Olá! Sou *${nome}*.\nPedido *${id}*: ${qtdAtual}x *${produtoAtual.nome}*.\nTotal: ${formatarMoeda(total)}.\n\n✅ *Li e concordo com os 50% de entrada.*\nAguardo chave Pix para pagamento.`;
                window.open(`https://wa.me/559292770409?text=${encodeURIComponent(msg)}`, '_blank');
                fecharModal();
            }
        }

        window.fecharSucesso = () => {
            const id = document.getElementById('sucesso-id').innerText;
            const msg = `Paguei o pedido *${id}*. Segue comprovante:`;
            window.open(`https://wa.me/559292770409?text=${encodeURIComponent(msg)}`, '_blank');
            document.getElementById('modal-sucesso').style.display = 'none';
        }

        document.getElementById('btn-secreto').addEventListener('click', () => { if(prompt("Senha:") === 'gabi123') { sessionStorage.setItem('admin_logado','sim'); window.location.href='admin.html'; } });
        carregarLoja();
    </script>
</body>
</html>