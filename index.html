<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja | Gabriele Personaliza</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <div class="container">
            <a href="#" class="logo">Gabriele <span>Personaliza</span></a>
            <nav>
                <div class="menu-toggle"><i class="fas fa-bars"></i></div>
                <ul class="nav-links">
                    <li><a href="#loja" class="active">Loja</a></li>
                    <li><a href="#sobre">Sobre</a></li>
                    <li><a href="https://wa.me/559292770409" target="_blank" class="btn-nav">Falar no WhatsApp</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="welcome-banner">
        <div class="container">
            <h1>Seja bem-vindo(a)!</h1>
            <p>Transforme sua festa com nossa papelaria criativa feita √† m√£o.</p>
            <div class="arrow-down">
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </section>

    <section id="loja" class="section-padding store-section">
        <div class="container">
            
            <div class="filter-container">
                <button class="filter-btn active" onclick="carregarLoja('todos')">Todos</button>
                <button class="filter-btn" onclick="carregarLoja('festa')">Festas</button>
                <button class="filter-btn" onclick="carregarLoja('cadernos')">Cadernos</button>
                <button class="filter-btn" onclick="carregarLoja('mimos')">Mimos</button>
            </div>

            <div class="product-grid" id="container-produtos">
                <p style="text-align:center; width:100%; grid-column: 1 / -1; padding: 40px; color: #888;">
                    <i class="fas fa-circle-notch fa-spin"></i> Carregando novidades...
                </p>
            </div>
        </div>
    </section>

    <section id="sobre" class="section-padding" style="background: #fff;">
        <div class="container about-container">
            <div class="about-text">
                <h2 class="section-title" style="text-align: left;">Quem faz?</h2>
                <p>A <strong>Gabriele Personaliza</strong> nasceu do desejo de transformar papel em mem√≥rias eternas. O que come√ßou como um hobby criativo, hoje √© uma marca dedicada a levar beleza e afeto para os seus momentos especiais.</p>
                <p style="margin-top: 15px;">Nosso atelier √© especializado em <strong>papelaria criativa e personalizados para festas</strong>. Trabalhamos com design exclusivo, cortes precisos e montagem feita 100% √† m√£o.</p>
            </div>
        </div>
    </section>

    <footer id="contato">
        <div class="container">
            <div class="footer-brand">
                <h3>Gabriele Personaliza</h3>
                <p>Feito com amor.</p>
            </div>
            
            <div class="socials">
                <a href="https://www.instagram.com/gabriele_personaliza/" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/559292770409" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>

            <div class="footer-support">
                <p>Entre em contato com o suporte: <a href="mailto:contato.gabriele.personaliza@gmail.com">contato.gabriele.personaliza@gmail.com</a></p>
            </div>
            
            <div class="copyright" id="area-secreta" style="cursor: help; user-select: none;" title="Acesso Restrito">
                <p>&copy; 2026 Gabriele Personaliza.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // CONFIGURA√á√ÉO
        const firebaseConfig = {
            apiKey: "AIzaSyBrRLiEFF8dfWHVxhK3popdYgEDQLiKzCM",
            authDomain: "gabriele-personaliza.firebaseapp.com",
            projectId: "gabriele-personaliza",
            storageBucket: "gabriele-personaliza.firebasestorage.app",
            messagingSenderId: "403724311605",
            appId: "1:403724311605:web:850e1bb14459a3ec60e57c",
            measurementId: "G-T24GYM57CT"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // FUN√á√ÉO PRINCIPAL DA LOJA
        window.carregarLoja = async function(filtro = 'todos') {
            const container = document.getElementById('container-produtos');
            
            // Atualiza bot√µes de filtro visualmente
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().includes(filtro) || (filtro === 'todos' && btn.innerText === 'Todos')) {
                    btn.classList.add('active');
                }
            });

            try {
                const querySnapshot = await getDocs(collection(db, "produtos"));
                
                if(querySnapshot.empty) {
                    container.innerHTML = '<p style="text-align:center; grid-column: 1/-1;">Nenhum produto encontrado.</p>';
                    return;
                }

                container.innerHTML = ''; 

                querySnapshot.forEach((doc) => {
                    const p = doc.data();
                    
                    if (filtro !== 'todos' && p.categoria !== filtro) return;

                    // 1. CARROSSEL DE IMAGENS
                    let imagensHtml = '';
                    let listaImagens = [];

                    // Verifica se √© array (novo) ou string (antigo)
                    if (p.fotos && p.fotos.length > 0) {
                        listaImagens = p.fotos;
                    } else if (p.foto) {
                        listaImagens = [p.foto];
                    }

                    let estiloExtra = p.ativo ? '' : 'filter: grayscale(1); opacity: 0.6;';

                    if (listaImagens.length > 0) {
                        // Cria as tags de imagem
                        listaImagens.forEach((imgUrl, index) => {
                            const classe = index === 0 ? 'carousel-img active' : 'carousel-img';
                            imagensHtml += `<img src="${imgUrl}" class="${classe}" style="${estiloExtra}">`;
                        });
                    } else {
                        // Placeholder
                        let corBg = '#E1BEE7';
                        if(p.categoria === 'festa') corBg = '#D1C4E9';
                        if(p.categoria === 'cadernos') corBg = '#BBDEFB';
                        imagensHtml = `
                            <div class="carousel-img active" style="background:${corBg}; width:100%; height:100%; display:flex; align-items:center; justify-content:center; ${estiloExtra}">
                                <i class="fas fa-camera" style="color:white; font-size:2rem"></i>
                            </div>`;
                    }

                    // 2. BOT√ÉO DE A√á√ÉO
                    let botaoAcao = '';
                    let etiqueta = '';

                    if (p.ativo) {
                        botaoAcao = `<a href="https://wa.me/559292770409?text=Ol√°, quero encomendar o ${p.nome}!" class="btn-sm" target="_blank">Pedir no WhatsApp</a>`;
                    } else {
                        botaoAcao = `<span class="btn-sm" style="color:red; cursor:not-allowed;">Esgotado</span>`;
                        etiqueta = '<div class="badge-bestseller" style="background:#F44336;">Esgotado</div>';
                    }

                    const html = `
                    <div class="product-card">
                        <div class="product-img-wrapper carousel-container">
                            ${etiqueta}
                            ${imagensHtml}
                        </div>
                        <div class="product-info">
                            <span class="category-tag">${p.categoria}</span>
                            <h3>${p.nome}</h3>
                            <div class="product-price">R$ ${p.preco}</div>
                            ${botaoAcao}
                        </div>
                    </div>
                    `;
                    container.innerHTML += html;
                });

                // Inicia anima√ß√£o se tiver mais de 1 foto
                iniciarCarrossel();
                
                if(container.innerHTML === '') {
                    container.innerHTML = '<p style="text-align:center; grid-column: 1/-1;">Nenhum produto nesta categoria.</p>';
                }

            } catch (error) {
                console.error("Erro na loja:", error);
                container.innerHTML = `<p style="text-align:center; color:red;">Erro: ${error.message}</p>`;
            }
        }

        // L√ìGICA DE TROCAR FOTOS SOZINHA
        function iniciarCarrossel() {
            if(window.carrosselInterval) clearInterval(window.carrosselInterval);
            
            window.carrosselInterval = setInterval(() => {
                document.querySelectorAll('.carousel-container').forEach(container => {
                    const imgs = container.querySelectorAll('.carousel-img');
                    if (imgs.length <= 1) return;

                    let activeIndex = 0;
                    imgs.forEach((img, i) => {
                        if (img.classList.contains('active')) activeIndex = i;
                        img.classList.remove('active');
                    });

                    let nextIndex = (activeIndex + 1) % imgs.length;
                    imgs[nextIndex].classList.add('active');
                });
            }, 3000); // 3 Segundos
        }

        carregarLoja();


        // 2. SISTEMA DE LOGIN SECRETO (DUPLO CLIQUE)
        const areaSecreta = document.getElementById('area-secreta');

        areaSecreta.addEventListener('dblclick', () => {
            // Vibra no celular pra avisar
            if (navigator.vibrate) navigator.vibrate(50);

            const senha = prompt("üîí √Årea Restrita da Gabriele.\nDigite a senha:");
            if(senha === "gabi123") {
                sessionStorage.setItem('admin_logado', 'sim');
                window.location.href = 'admin.html';
            } else if (senha !== null) {
                alert("Senha Incorreta!");
            }
        });

    </script>
</body>
</html>