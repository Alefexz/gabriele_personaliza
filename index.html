<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja | Gabriele Personaliza</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* --- ESTILOS EXTRAS (MODAL E CARROSSEL) --- */
        
        /* Modal de Produto */
        .modal-produto-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: end; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 20px 20px 0 0; padding: 25px; animation: slideUp 0.3s; position: relative; max-height: 90vh; overflow-y: auto; }
        @media(min-width: 768px) { .modal-produto-overlay { align-items: center; } .modal-content { border-radius: 20px; } }
        @keyframes slideUp { from {transform: translateY(100%)} to {transform: translateY(0)} }
        
        .modal-img-container { height: 250px; overflow: hidden; border-radius: 10px; margin-bottom: 15px; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; }
        .modal-img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; scroll-snap-align: center; }
        
        .modal-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: #333; margin-bottom: 5px; }
        .modal-price { font-size: 1.3rem; color: #B39DDB; font-weight: bold; margin-bottom: 15px; }
        .modal-desc { font-size: 0.9rem; color: #666; line-height: 1.6; margin-bottom: 20px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #555; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        
        /* Bot√µes do Modal */
        .btn-comprar { background: #25D366; color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; display: flex; justify-content: center; gap: 10px; align-items: center; margin-top: 10px; }
        .btn-comprar:hover { background: #1ebd56; }
        
        .btn-cartao { background: #009EE3; color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; display: none; justify-content: center; gap: 10px; align-items: center; text-decoration: none; margin-bottom: 10px; }
        .btn-cartao:hover { background: #0081b8; }

        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #aaa; }

        /* Modal de Sucesso */
        #modal-sucesso { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: center; text-align: center; }
        .sucesso-card { background: white; padding: 40px; border-radius: 20px; width: 90%; max-width: 400px; }
        .pedido-id { font-size: 1.5rem; font-weight: bold; color: #B39DDB; margin: 10px 0; letter-spacing: 2px; border: 2px dashed #B39DDB; padding: 10px; border-radius: 10px; display: inline-block; }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <a href="#" class="logo">Gabriele <span>Personaliza</span></a>
            <nav>
                <div class="menu-toggle"><i class="fas fa-bars"></i></div>
                <ul class="nav-links">
                    <li><a href="#loja" class="active">Loja</a></li>
                    <li><a href="#sobre">Sobre</a></li>
                    <li><a href="https://wa.me/559292770409" target="_blank" class="btn-nav">Falar no WhatsApp</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="welcome-banner">
        <div class="container">
            <h1>Seja bem-vindo(a)!</h1>
            <p>Transforme sua festa com nossa papelaria criativa feita √† m√£o.</p>
            <div class="arrow-down"><i class="fas fa-chevron-down"></i></div>
        </div>
    </section>

    <section id="loja" class="section-padding store-section">
        <div class="container">
            <div class="filter-container">
                <button class="filter-btn active" onclick="carregarLoja('todos')">Todos</button>
                <button class="filter-btn" onclick="carregarLoja('festa')">Festas</button>
                <button class="filter-btn" onclick="carregarLoja('cadernos')">Cadernos</button>
                <button class="filter-btn" onclick="carregarLoja('mimos')">Mimos</button>
            </div>

            <div class="product-grid" id="container-produtos">
                <p style="text-align:center; width:100%; grid-column: 1 / -1; padding: 40px; color: #888;">
                    <i class="fas fa-circle-notch fa-spin"></i> Carregando novidades...
                </p>
            </div>
        </div>
    </section>

    <section id="sobre" class="section-padding" style="background: #fff;">
        <div class="container about-container">
            <div class="about-text">
                <h2 class="section-title" style="text-align: left;">Quem faz?</h2>
                <p>A <strong>Gabriele Personaliza</strong> nasceu do desejo de transformar papel em mem√≥rias eternas. O que come√ßou como um hobby criativo, hoje √© uma marca dedicada a levar beleza e afeto para os seus momentos especiais.</p>
                <p style="margin-top: 15px;">Nosso atelier √© especializado em <strong>papelaria criativa e personalizados para festas</strong>. Trabalhamos com design exclusivo, cortes precisos e montagem feita 100% √† m√£o.</p>
            </div>
        </div>
    </section>

    <footer id="contato">
        <div class="container">
            <div class="footer-brand">
                <h3>Gabriele Personaliza</h3>
                <p>Feito com amor.</p>
            </div>
            
            <div class="socials">
                <a href="https://www.instagram.com/gabriele_personaliza/" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/559292770409" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>

            <div class="footer-support">
                <p>Entre em contato com o suporte: <a href="mailto:contato.gabriele.personaliza@gmail.com">contato.gabriele.personaliza@gmail.com</a></p>
            </div>
            
            <div class="copyright">
                <p>
                    &copy; 2026 Gabriele Personaliza. 
                    <span id="btn-secreto" style="opacity: 0.3; cursor: pointer; font-weight: bold; margin-left: 5px;" title="Acesso Admin">G</span>
                </p>
            </div>
        </div>
    </footer>

    <div id="modal-produto" class="modal-produto-overlay">
        <div class="modal-content">
            <i class="fas fa-times close-modal" onclick="fecharModal()"></i>
            
            <div id="modal-imagens" class="modal-img-container"></div>
            
            <h3 id="modal-titulo" class="modal-title">Nome do Produto</h3>
            <div id="modal-preco" class="modal-price">R$ 0,00</div>
            
            <div id="modal-descricao" class="modal-desc"></div>
            
            <div style="border-top: 1px solid #eee; padding-top: 20px;">
                <h4 style="margin-bottom: 15px; color: #555;">Finalizar Pedido</h4>
                
                <div class="input-group">
                    <label>Seu Nome *</label>
                    <input type="text" id="cliente-nome" placeholder="Como podemos te chamar?">
                </div>
                <div class="input-group">
                    <label>WhatsApp (DDD + N√∫mero) *</label>
                    <input type="tel" id="cliente-zap" placeholder="Para contato sobre a entrega">
                </div>

                <div style="margin-top: 20px;">
                    <button id="btn-pagar-link" class="btn-cartao" onclick="pagarComCartao()">
                        <i class="fas fa-credit-card"></i> Pagar Agora (Cart√£o/Pix)
                    </button>

                    <p id="divisor-pagamento" style="text-align:center; font-size:0.8rem; color:#888; margin:5px 0;">- OU -</p>
                    
                    <button class="btn-comprar" onclick="finalizarPedidoZap()">
                        <i class="fab fa-whatsapp"></i> Pedir no WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-sucesso">
        <div class="sucesso-card">
            <i class="fas fa-check-circle" style="font-size: 3rem; color: #2E7D32; margin-bottom: 20px;"></i>
            <h3>Pedido Iniciado!</h3>
            <p>Seu c√≥digo de pedido √©:</p>
            <div class="pedido-id" id="sucesso-id">#1234</div>
            <p style="margin-top:20px; font-size:0.9rem; color:#666">
                Se voc√™ j√° pagou, envie este c√≥digo no WhatsApp para confirmarmos seu pedido.
            </p>
            <button class="btn-comprar" onclick="fecharSucesso()" style="margin-top:20px">
                <i class="fab fa-whatsapp"></i> Enviar Comprovante
            </button>
        </div>
    </div>

    <script src="script.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBrRLiEFF8dfWHVxhK3popdYgEDQLiKzCM",
            authDomain: "gabriele-personaliza.firebaseapp.com",
            projectId: "gabriele-personaliza",
            storageBucket: "gabriele-personaliza.firebasestorage.app",
            messagingSenderId: "403724311605",
            appId: "1:403724311605:web:850e1bb14459a3ec60e57c",
            measurementId: "G-T24GYM57CT"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let produtoAtual = {};

        // 1. CARREGAR LOJA + CARROSSEL
        window.carregarLoja = async (filtro = 'todos') => {
            const container = document.getElementById('container-produtos');
            
            // Bot√µes de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().includes(filtro) || (filtro === 'todos' && btn.innerText === 'Todos')) {
                    btn.classList.add('active');
                }
            });

            try {
                const q = await getDocs(collection(db, "produtos"));
                container.innerHTML = '';
                
                let produtosEncontrados = 0;

                q.forEach(doc => {
                    const p = doc.data();
                    if(filtro !== 'todos' && p.categoria !== filtro) return;
                    produtosEncontrados++;

                    // Carrossel
                    let listaImagens = [];
                    if (p.fotos && p.fotos.length > 0) listaImagens = p.fotos;
                    else if (p.foto) listaImagens = [p.foto];

                    let imagensHtml = '';
                    let estiloExtra = p.ativo ? '' : 'filter: grayscale(1); opacity: 0.6;';

                    if (listaImagens.length > 0) {
                        listaImagens.forEach((imgUrl, index) => {
                            const classe = index === 0 ? 'carousel-img active' : 'carousel-img';
                            imagensHtml += `<img src="${imgUrl}" class="${classe}" style="${estiloExtra}">`;
                        });
                    } else {
                        let corBg = '#E1BEE7';
                        if(p.categoria === 'festa') corBg = '#D1C4E9';
                        imagensHtml = `<div class="carousel-img active" style="background:${corBg}; width:100%; height:100%; display:flex; align-items:center; justify-content:center; ${estiloExtra}"><i class="fas fa-camera" style="color:white; font-size:2rem"></i></div>`;
                    }

                    // Bot√£o
                    let btnHtml = p.ativo ? 
                        `<button class="btn-sm" style="width:100%; border:none; background:#B39DDB; color:white; padding:8px; border-radius:5px; cursor:pointer; margin-top:5px;">Ver Detalhes</button>` : 
                        `<span style="color:red; font-size:0.8rem">Esgotado</span>`;
                    
                    let etiqueta = p.ativo ? '' : '<div class="badge-bestseller" style="background:#F44336;">Esgotado</div>';

                    // Card HTML
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <div class="product-img-wrapper carousel-container">
                            ${etiqueta}
                            ${imagensHtml}
                        </div>
                        <div class="product-info">
                            <span class="category-tag">${p.categoria}</span>
                            <h3>${p.nome}</h3>
                            <div class="product-price">R$ ${p.preco}</div>
                            ${btnHtml}
                        </div>
                    `;
                    
                    if(p.ativo) {
                        card.onclick = () => abrirModal(p);
                    }
                    container.appendChild(card);
                });

                if(produtosEncontrados === 0) {
                    container.innerHTML = '<p style="text-align:center; grid-column: 1/-1; padding: 20px;">Nenhum produto nesta categoria.</p>';
                } else {
                    iniciarCarrossel();
                }

            } catch(e) { console.error(e); }
        }

        // 2. L√ìGICA DO CARROSSEL
        function iniciarCarrossel() {
            if(window.carrosselInterval) clearInterval(window.carrosselInterval);
            window.carrosselInterval = setInterval(() => {
                document.querySelectorAll('.carousel-container').forEach(container => {
                    const imgs = container.querySelectorAll('.carousel-img');
                    if (imgs.length <= 1) return;
                    let activeIndex = 0;
                    imgs.forEach((img, i) => { if (img.classList.contains('active')) activeIndex = i; img.classList.remove('active'); });
                    let nextIndex = (activeIndex + 1) % imgs.length;
                    imgs[nextIndex].classList.add('active');
                });
            }, 3000);
        }

        // 3. ABRIR MODAL
        window.abrirModal = (p) => {
            produtoAtual = p;
            document.getElementById('modal-produto').style.display = 'flex';
            document.getElementById('modal-titulo').innerText = p.nome;
            document.getElementById('modal-preco').innerText = `R$ ${p.preco}`;
            document.getElementById('modal-descricao').innerText = p.descricao || "Entre em contato para saber mais detalhes.";
            
            const imgContainer = document.getElementById('modal-imagens'); imgContainer.innerHTML = '';
            const fotos = p.fotos || [p.foto];
            if(fotos && fotos.length > 0) fotos.forEach(f => { if(f) imgContainer.innerHTML += `<img src="${f}" class="modal-img">`; });
            else imgContainer.innerHTML = '<div style="background:#eee;width:100%;height:100%"></div>';

            // Mostra bot√£o de cart√£o S√ì SE TIVER LINK
            const btnLink = document.getElementById('btn-pagar-link');
            const divisor = document.getElementById('divisor-pagamento');
            
            if(p.link_pagamento && p.link_pagamento.length > 5) {
                btnLink.style.display = 'flex';
                divisor.style.display = 'block';
            } else {
                btnLink.style.display = 'none';
                divisor.style.display = 'none';
            }
        }

        window.fecharModal = () => document.getElementById('modal-produto').style.display = 'none';

        // 4. SISTEMA DE PEDIDOS (CRIA ID E SALVA)
        async function registrarPedido(origem) {
            const nome = document.getElementById('cliente-nome').value;
            const zap = document.getElementById('cliente-zap').value;
            
            if(!nome || !zap) {
                alert("Por favor, preencha seu Nome e WhatsApp!");
                return null;
            }

            const idCurto = '#' + Math.random().toString(36).substr(2, 4).toUpperCase();
            
            try {
                await addDoc(collection(db, "pedidos"), { 
                    id_visual: idCurto,
                    cliente: nome, whatsapp: zap, produto: produtoAtual.nome, total: produtoAtual.preco, 
                    data: new Date().toISOString(), 
                    status: origem === 'Cart√£o' ? 'Aguardando Pagamento' : 'Pendente',
                    origem: origem 
                });
                return idCurto;
            } catch(e) {
                alert("Erro ao registrar: " + e.message);
                return null;
            }
        }

        window.pagarComCartao = async () => {
            const btn = document.getElementById('btn-pagar-link');
            const txtOriginal = btn.innerHTML;
            btn.innerHTML = "Gerando Pedido...";

            const idPedido = await registrarPedido('Cart√£o');
            if(idPedido) {
                // Abre MP
                window.open(produtoAtual.link_pagamento, '_blank');
                // Mostra sucesso
                fecharModal();
                document.getElementById('sucesso-id').innerText = idPedido;
                document.getElementById('modal-sucesso').style.display = 'flex';
            }
            btn.innerHTML = txtOriginal;
        }

        window.finalizarPedidoZap = async () => {
            const idPedido = await registrarPedido('WhatsApp');
            if(idPedido) {
                const nome = document.getElementById('cliente-nome').value;
                const msg = `Ol√°! Sou *${nome}*.\nFiz o pedido *${idPedido}* (${produtoAtual.nome} - R$ ${produtoAtual.preco}).\nAguardo confirma√ß√£o!`;
                window.open(`https://wa.me/559292770409?text=${encodeURIComponent(msg)}`, '_blank');
                fecharModal();
            }
        }

        window.fecharSucesso = () => {
            const id = document.getElementById('sucesso-id').innerText;
            const nome = document.getElementById('cliente-nome').value;
            const msg = `Ol√°! Sou *${nome}*.\nAcabei de pagar o pedido *${id}*.\nSegue o comprovante:`;
            window.open(`https://wa.me/559292770409?text=${encodeURIComponent(msg)}`, '_blank');
            document.getElementById('modal-sucesso').style.display = 'none';
        }

        // 5. BOT√ÉO SECRETO "G"
        document.getElementById('btn-secreto').addEventListener('click', () => {
            const senha = prompt("üîí Senha Admin:");
            if(senha === 'gabi123') {
                sessionStorage.setItem('admin_logado','sim'); 
                window.location.href='admin.html';
            }
        });

        carregarLoja();
    </script>
</body>
</html>