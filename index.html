<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja | Gabriele Personaliza</title>
    <meta property="og:title" content="Gabriele Personaliza | Papelaria Criativa">
    <meta property="og:description" content="Transforme sua festa com mimos e personalizados feitos à mão. Confira nosso catálogo!">
    <meta property="og:image" content="https://i.ibb.co/h7XN8kG/logo.png"> 
    <meta property="og:url" content="https://gabriele-personaliza.web.app">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#B39DDB">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=3">
    <style>
        /* CSS MANTIDO IGUAL */
        .politicas-lista { text-align: left; margin-top: 15px; }
        .politicas-lista li { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; color: #555; font-size: 0.9rem; }
        .politicas-lista i { color: #B39DDB; margin-right: 10px; width: 20px; text-align: center; }

        @media (max-width: 768px) {
            .nav-links.active {
                display: flex;
                flex-direction: column;
                position: absolute;
                top: 70px; left: 0; width: 100%;
                background: white; box-shadow: 0 10px 15px rgba(0,0,0,0.1);
                padding: 20px 0; animation: slideDown 0.3s ease forwards;
            }
            .nav-links.active li { width: 100%; text-align: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
            .nav-links.active li a { display: block; font-size: 1.1rem; }
            .nav-links.active .btn-nav { display: inline-block; margin-top: 10px; }
            @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        }

        .modal-produto-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: end; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 20px 20px 0 0; padding: 25px; animation: slideUp 0.3s; position: relative; max-height: 90vh; overflow-y: auto; }
        @media(min-width: 768px) { .modal-produto-overlay { align-items: center; } .modal-content { border-radius: 20px; } }
        @keyframes slideUp { from {transform: translateY(100%)} to {transform: translateY(0)} }
        .modal-img-container { height: 300px; overflow: hidden; border-radius: 10px; margin-bottom: 15px; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; background-color: #f0f0f0; }
        /* Adicionei cursor pointer para indicar clique */
        .modal-img { width: 100%; height: 100%; object-fit: contain; flex-shrink: 0; scroll-snap-align: center; cursor: zoom-in; }
        .modal-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: #333; margin-bottom: 5px; }
        .modal-price { font-size: 1.3rem; color: #B39DDB; font-weight: bold; margin-bottom: 15px; }
        .modal-desc { font-size: 0.9rem; color: #666; line-height: 1.6; margin-bottom: 20px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        .qtd-wrapper { margin-bottom: 20px; background: #f0f0f0; padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; }
        .qtd-controls { display: flex; align-items: center; gap: 10px; }
        .btn-qtd { width: 35px; height: 35px; background: #B39DDB; color: white; border: none; border-radius: 50%; font-weight: bold; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .qtd-display { font-size: 1.2rem; font-weight: bold; width: 30px; text-align: center; }
        .total-price { font-weight: bold; color: #333; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #555; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .termos-box { background: #FFF3E0; border: 1px solid #FFCC80; padding: 10px; border-radius: 8px; margin: 15px 0; display: flex; gap: 10px; align-items: flex-start; transition: 0.3s; }
        .termos-box input { margin-top: 5px; transform: scale(1.2); cursor: pointer; }
        .termos-text { font-size: 0.8rem; color: #E65100; line-height: 1.4; }
        .termos-text strong { font-weight: bold; text-decoration: underline; }
        .btn-comprar { background: #25D366; color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; display: flex; justify-content: center; gap: 10px; align-items: center; margin-top: 10px; }
        .btn-cartao { background: #009EE3; color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; display: none; justify-content: center; gap: 10px; align-items: center; text-decoration: none; margin-bottom: 10px; }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #aaa; }
        #custom-alert { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 5000; justify-content: center; align-items: center; }
        .alert-box { background: white; padding: 30px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .alert-icon { font-size: 3rem; color: #FFC107; margin-bottom: 15px; display: block; }
        .alert-title { font-size: 1.2rem; font-weight: bold; color: #333; margin-bottom: 10px; font-family: 'Playfair Display', serif; }
        .alert-msg { font-size: 0.9rem; color: #666; line-height: 1.5; margin-bottom: 20px; }
        .alert-btn { background: #B39DDB; color: white; border: none; padding: 12px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1rem; width: 100%; transition: 0.2s; }
        .alert-btn:hover { background: #9575CD; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        #modal-sucesso { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: center; text-align: center; }
        .sucesso-card { background: white; padding: 40px; border-radius: 20px; width: 90%; max-width: 400px; }
        .pedido-id { font-size: 1.5rem; font-weight: bold; color: #B39DDB; margin: 10px 0; letter-spacing: 2px; border: 2px dashed #B39DDB; padding: 10px; border-radius: 10px; display: inline-block; }
        .filter-btn[onclick*="promocao"] { background-color: #FCE4EC; color: #E91E63; border: 1px solid #F8BBD0; }
        .filter-btn[onclick*="promocao"].active { background-color: #E91E63; color: white; }

        /* --- NOVO CSS PARA O ZOOM (FULLSCREEN) --- */
        #fullscreen-overlay {
            display: none;
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); /* Fundo bem escuro */
            z-index: 9999;
            justify-content: center; align-items: center;
            cursor: zoom-out; /* Ícone de diminuir */
            animation: fadeIn 0.3s;
        }
        #fullscreen-img {
            max-width: 95%; max-height: 95%;
            object-fit: contain;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .close-fullscreen {
            position: absolute; top: 20px; right: 20px;
            color: white; font-size: 40px; cursor: pointer;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="#" class="logo">Gabriele <span>Personaliza</span></a>
            <nav>
                <div class="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
                <ul class="nav-links" id="nav-lista">
                    <li><a href="#loja" class="active" onclick="toggleMenu()">Loja</a></li>
                    <li><a href="#sobre" onclick="toggleMenu()">Sobre</a></li>
                    <li><a href="#" onclick="abrirPoliticas(); toggleMenu()">Como Funciona?</a></li>
                    <li><a href="https://wa.me/559292770409" target="_blank" class="btn-nav">Falar no WhatsApp</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="welcome-banner">
        <div class="container">
            <h1>Seja bem-vindo(a)!</h1>
            <p>Transforme sua festa com nossa papelaria criativa feita à mão.</p>
            <div class="hero-socials">
                <a href="https://www.instagram.com/gabriele_personaliza/" target="_blank" class="social-big insta-bg"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/559292770409" target="_blank" class="social-big zap-bg"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="arrow-down"><i class="fas fa-chevron-down"></i></div>
        </div>
    </section>

    <section id="loja" class="section-padding store-section">
        <div class="container">
            <div class="search-container">
                <input type="text" id="campo-busca" class="search-input" placeholder="O que você procura hoje?" onkeyup="filtrarPorNome()">
                <i class="fas fa-search search-icon"></i>
            </div>

            <div class="filter-container">
                <button class="filter-btn active" onclick="aplicarFiltros('todos')">Todos</button>
                <button class="filter-btn" onclick="aplicarFiltros('promocao')"><i class="fas fa-tag"></i> Promoções</button>
                <button class="filter-btn" onclick="aplicarFiltros('festa')">Festas</button>
                <button class="filter-btn" onclick="aplicarFiltros('cadernos')">Cadernos</button>
                <button class="filter-btn" onclick="aplicarFiltros('mimos')">Mimos</button>
                <button class="filter-btn" onclick="aplicarFiltros('simples')">Simples</button>
                <button class="filter-btn" onclick="aplicarFiltros('semiluxo')">Semi Luxo</button>
            </div>
            
            <div class="product-grid" id="container-produtos">
                </div>
        </div>
    </section>

    <section id="sobre" class="section-padding" style="background: #fff;">
        <div class="container about-container">
            <div class="about-text">
                <h2 class="section-title" style="text-align: left;">Quem faz?</h2>
                <p>A <strong>Gabriele Personaliza</strong> nasceu do desejo de transformar papel em memórias eternas. O que começou como um hobby criativo, hoje é uma marca dedicada a levar beleza e afeto para os seus momentos especiais.</p>
                <p style="margin-top: 15px;">Nosso atelier é especializado em <strong>papelaria criativa e personalizados para festas</strong>. Trabalhamos com design exclusivo, cortes precisos e montagem feita 100% à mão.</p>
            </div>
        </div>
    </section>

    <footer id="contato">
        <div class="container">
            <div class="footer-brand"><h3>Gabriele Personaliza</h3><p>Feito com amor.</p></div>
            <div class="socials">
                <a href="https://www.instagram.com/gabriele_personaliza/" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/559292770409" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="copyright">
                <p>&copy; <span id="ano-atual"></span>. <span id="btn-secreto" style="opacity: 0.3; cursor: pointer; font-weight: bold; margin-left: 5px;">G</span></p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/559292770409" class="floating-whatsapp" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <div id="modal-produto" class="modal-produto-overlay">
        <div class="modal-content">
            <i class="fas fa-times close-modal" onclick="fecharModal()"></i>
            <div id="modal-imagens" class="modal-img-container"></div>
            
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <h3 id="modal-titulo" class="modal-title">Nome</h3>
                <button onclick="compartilharProduto()" style="background:none; border:none; color:#B39DDB; font-size:1.5rem; cursor:pointer; padding:0 10px;">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>

            <div id="modal-preco-container" class="modal-price">R$ 0,00</div>
            <div id="modal-descricao" class="modal-desc"></div>
            
            <div style="border-top: 1px solid #eee; padding-top: 20px;">
                <div class="qtd-wrapper">
                    <div class="qtd-controls">
                        <button class="btn-qtd" onclick="mudarQtd(-1)">-</button>
                        <span id="qtd-numero" class="qtd-display">1</span>
                        <button class="btn-qtd" onclick="mudarQtd(1)">+</button>
                    </div>
                    <div id="total-final" class="total-price">Total: R$ 0,00</div>
                </div>
                <div class="input-group">
                    <label>Seu Nome *</label><input type="text" id="cliente-nome" placeholder="Seu nome">
                </div>
                <div class="input-group">
                    <label>WhatsApp *</label><input type="tel" id="cliente-zap" placeholder="Seu número">
                </div>
                <div class="termos-box" id="box-termos">
                    <input type="checkbox" id="check-termos">
                    <div class="termos-text">Estou ciente do pagamento de <strong>50% de entrada</strong>.<br><span style="font-size:0.75rem;">* Valor não reembolsável em caso de desistência.</span></div>
                </div>
                <button id="btn-pagar-link" class="btn-cartao" onclick="pagarComCartao()"><i class="fas fa-credit-card"></i> Pagar com Cartão</button>
                <p id="divisor-pagamento" style="text-align:center; font-size:0.8rem; color:#888; margin:5px 0; display:none;">- OU -</p>
                <button class="btn-comprar" onclick="finalizarPedidoZap()"><i class="fab fa-whatsapp"></i> Pedir no WhatsApp</button>
            </div>
        </div>
    </div>

    <div id="modal-politicas" class="modal-produto-overlay">
        <div class="modal-content" style="max-height: 80vh;">
            <i class="fas fa-times close-modal" onclick="fecharPoliticas()"></i>
            <h3 class="modal-title" style="text-align:center; margin-bottom:20px;">Como Funciona?</h3>
            
            <ul class="politicas-lista">
                <li><i class="fas fa-calendar-alt"></i> <strong>Prazos:</strong> Pedimos antecedência mínima de 7 a 15 dias, dependendo do produto.</li>
                <li><i class="fas fa-hand-holding-usd"></i> <strong>Pagamento:</strong> Solicitamos 50% do valor no ato do pedido para iniciar a produção.</li>
                <li><i class="fas fa-exclamation-triangle"></i> <strong>Cancelamento:</strong> Em caso de desistência, o valor da entrada não é reembolsado (cobre custos de material).</li>
                <li><i class="fas fa-paint-brush"></i> <strong>Arte:</strong> Enviamos a arte para aprovação antes da impressão final.</li>
                <li><i class="fas fa-shipping-fast"></i> <strong>Entrega:</strong> Retirada no local ou entrega via Uber Flash (custo do cliente).</li>
            </ul>

            <button class="alert-btn" onclick="fecharPoliticas()" style="margin-top:20px;">Entendi!</button>
        </div>
    </div>

    <div id="custom-alert">
        <div class="alert-box">
            <i class="fas fa-exclamation-circle alert-icon"></i>
            <div class="alert-title">Atenção</div>
            <p class="alert-msg" id="msg-alerta">Mensagem</p>
            <button class="alert-btn" onclick="fecharAlerta()">Entendi</button>
        </div>
    </div>

    <div id="modal-sucesso">
        <div class="sucesso-card">
            <i class="fas fa-check-circle" style="font-size: 3rem; color: #2E7D32; margin-bottom: 20px;"></i>
            <h3>Pedido Iniciado!</h3>
            <div class="pedido-id" id="sucesso-id">#1234</div>
            <p style="margin-top:20px; font-size:0.9rem; color:#666">Envie este código no WhatsApp.</p>
            <button class="btn-comprar" onclick="fecharSucesso()" style="margin-top:20px"><i class="fab fa-whatsapp"></i> Enviar Comprovante</button>
        </div>
    </div>

    <div id="fullscreen-overlay" onclick="fecharImagemCheia()">
        <span class="close-fullscreen">&times;</span>
        <img id="fullscreen-img" src="">
    </div>

    <script src="script.js?v=5"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBrRLiEFF8dfWHVxhK3popdYgEDQLiKzCM", authDomain: "gabriele-personaliza.firebaseapp.com", projectId: "gabriele-personaliza", storageBucket: "gabriele-personaliza.firebasestorage.app", messagingSenderId: "403724311605", appId: "1:403724311605:web:850e1bb14459a3ec60e57c", measurementId: "G-T24GYM57CT" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let todosProdutos = [];
        let produtoAtual = {}, qtdAtual = 1, minimoAtual = 1;

        window.toggleMenu = () => { const nav = document.getElementById('nav-lista'); nav.classList.toggle('active'); }
        window.abrirPoliticas = () => document.getElementById('modal-politicas').style.display = 'flex';
        window.fecharPoliticas = () => document.getElementById('modal-politicas').style.display = 'none';

        // --- FUNÇÕES DE ZOOM (TELA CHEIA) ---
        window.abrirImagemCheia = (src) => {
            document.getElementById('fullscreen-img').src = src;
            document.getElementById('fullscreen-overlay').style.display = 'flex';
        }
        window.fecharImagemCheia = () => {
            document.getElementById('fullscreen-overlay').style.display = 'none';
            document.getElementById('fullscreen-img').src = '';
        }

        const formatarMoeda = (valor) => parseFloat(valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        window.mostrarAlerta = (msg) => { document.getElementById('msg-alerta').innerText = msg; document.getElementById('custom-alert').style.display = 'flex'; }
        window.fecharAlerta = () => document.getElementById('custom-alert').style.display = 'none';

        function mostrarSkeleton() {
            const container = document.getElementById('container-produtos');
            container.innerHTML = '';
            for(let i=0; i<6; i++) {
                container.innerHTML += `<div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-title" style="width: 60%"></div><div class="skeleton skeleton-price"></div></div>`;
            }
        }

        window.carregarLoja = async (filtroInicial = 'todos') => {
            mostrarSkeleton();
            try {
                const q = await getDocs(collection(db, "produtos"));
                todosProdutos = [];
                q.forEach(doc => { let p = doc.data(); p.id = doc.id; todosProdutos.push(p); });
                aplicarFiltros(filtroInicial);
            } catch(e) { console.error(e); document.getElementById('container-produtos').innerHTML = '<p style="grid-column:1/-1; text-align:center">Erro ao carregar produtos. Verifique sua internet.</p>'; }
        }

        window.aplicarFiltros = (categoria) => {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().includes(categoria.replace('promocao','promoçõe')) || (categoria === 'todos' && btn.innerText === 'Todos')) btn.classList.add('active');
            });
            const filtrados = todosProdutos.filter(p => {
                if (categoria === 'todos') return true;
                if (categoria === 'promocao') return p.em_promocao && p.ativo;
                return p.categoria === categoria;
            });
            renderizarCards(filtrados);
        }

        window.filtrarPorNome = () => {
            const termo = document.getElementById('campo-busca').value.toLowerCase();
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            const filtrados = todosProdutos.filter(p => p.nome.toLowerCase().includes(termo));
            renderizarCards(filtrados, termo !== "" ? "Nenhum produto encontrado com esse nome." : "Nenhum produto encontrado.");
        }

        function renderizarCards(lista, msgVazio = "Nenhum produto encontrado.") {
            const container = document.getElementById('container-produtos');
            container.innerHTML = '';
            if (lista.length === 0) { container.innerHTML = `<p style="text-align:center; width:100%; grid-column: 1 / -1; padding: 40px; color: #888;">${msgVazio}</p>`; return; }
            
            const timestamp = new Date().getTime();

            lista.forEach(p => {
                let listaImagens = (p.fotos && p.fotos.length > 0) ? p.fotos : (p.foto ? [p.foto] : []);
                let imagensHtml = '';
                let estiloExtra = p.ativo ? '' : 'filter: grayscale(1); opacity: 0.6;';
                
                if (listaImagens.length > 0) {
                    listaImagens.forEach((imgUrl, index) => {
                        let finalUrl = imgUrl;
                        if (imgUrl.startsWith('http')) {
                            finalUrl = `${imgUrl}?t=${timestamp}`;
                        }
                        imagensHtml += `<img src="${finalUrl}" class="carousel-img ${index===0?'active':''}" style="${estiloExtra}">`;
                    });
                } else {
                    imagensHtml = `<div class="carousel-img active" style="background:#E1BEE7;height:100%"></div>`;
                }
                
                const minLabel = (p.minimo && p.minimo > 1) ? `<small style="display:block; color:#666; margin-top:5px">Mínimo: ${p.minimo} un</small>` : '';
                let btnHtml = p.ativo ? `<button class="btn-sm" style="width:100%;border:none;background:#B39DDB;color:white;padding:8px;border-radius:5px;cursor:pointer;margin-top:5px;">Ver Detalhes</button>` : `<span style="color:red;font-size:0.8rem">Esgotado</span>`;
                let etiqueta = '';
                if (!p.ativo) etiqueta = '<div class="badge-bestseller" style="background:#F44336;">Esgotado</div>';
                else if (p.em_promocao && p.preco_promocional > 0) etiqueta = '<div class="badge-promo"><i class="fas fa-tag"></i> Oferta!</div>';
                let priceHtml = formatarMoeda(p.preco);
                if (p.ativo && p.em_promocao && p.preco_promocional > 0) priceHtml = `<span class="original-price">${formatarMoeda(p.preco)}</span> <span class="promo-price">${formatarMoeda(p.preco_promocional)}</span>`;
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `<div class="product-img-wrapper carousel-container">${etiqueta}${imagensHtml}</div><div class="product-info"><span class="category-tag">${p.categoria.toUpperCase()}</span><h3>${p.nome}</h3><div class="product-price">${priceHtml}</div>${minLabel}${btnHtml}</div>`;
                if(p.ativo) card.onclick = () => abrirModal(p);
                container.appendChild(card);
            });
            iniciarCarrossel();
        }

        function iniciarCarrossel() {
            if(window.carrosselInterval) clearInterval(window.carrosselInterval);
            window.carrosselInterval = setInterval(() => {
                document.querySelectorAll('.carousel-container').forEach(c => {
                    const imgs = c.querySelectorAll('.carousel-img');
                    if (imgs.length <= 1) return;
                    let active = 0;
                    imgs.forEach((img, i) => { if(img.classList.contains('active')) active = i; img.classList.remove('active'); });
                    imgs[(active + 1) % imgs.length].classList.add('active');
                });
            }, 3000);
        }

        window.abrirModal = (p) => {
            produtoAtual = p; minimoAtual = p.minimo || 1; qtdAtual = minimoAtual; 
            document.getElementById('modal-produto').style.display = 'flex';
            document.getElementById('modal-titulo').innerText = p.nome;
            let priceHtmlModal = formatarMoeda(p.preco);
            if (p.em_promocao && p.preco_promocional > 0) priceHtmlModal = `<span class="original-price">${formatarMoeda(p.preco)}</span> <span class="promo-price">${formatarMoeda(p.preco_promocional)}</span>`;
            document.getElementById('modal-preco-container').innerHTML = priceHtmlModal;
            document.getElementById('modal-descricao').innerText = p.descricao || "";
            document.getElementById('check-termos').checked = false; 
            document.getElementById('box-termos').style.border = "1px solid #FFCC80"; 
            
            const imgC = document.getElementById('modal-imagens'); imgC.innerHTML = '';
            const timestamp = new Date().getTime();
            
            // --- ATUALIZAÇÃO: AGORA O CLIQUE CHAMA O ZOOM ---
            (p.fotos || [p.foto]).forEach(f => { 
                if(f) {
                    let finalUrl = f;
                    if (f.startsWith('http')) {
                        finalUrl = `${f}?t=${timestamp}`;
                    }
                    // Adicionei onclick="abrirImagemCheia(this.src)"
                    imgC.innerHTML += `<img src="${finalUrl}" class="modal-img" onclick="abrirImagemCheia(this.src)">`; 
                }
            });
            
            atualizarUI();
        }

        window.mudarQtd = (delta) => {
            let novaQtd = qtdAtual + delta;
            if (novaQtd >= minimoAtual) { qtdAtual = novaQtd; atualizarUI(); }
        }

        function atualizarUI() {
            document.getElementById('qtd-numero').innerText = qtdAtual;
            let precoEfetivo = (produtoAtual.em_promocao && produtoAtual.preco_promocional > 0) ? produtoAtual.preco_promocional : produtoAtual.preco;
            let total = precoEfetivo * qtdAtual;
            document.getElementById('total-final').innerText = `Total: ${formatarMoeda(total)}`;
            const btnLink = document.getElementById('btn-pagar-link'); const div = document.getElementById('divisor-pagamento');
            if (produtoAtual.link_pagamento && produtoAtual.link_pagamento.length > 5 && qtdAtual === 1) { btnLink.style.display = 'flex'; div.style.display = 'block'; }
            else { btnLink.style.display = 'none'; div.style.display = 'none'; }
        }

        window.fecharModal = () => document.getElementById('modal-produto').style.display = 'none';

        function validarTermos() {
            const check = document.getElementById('check-termos');
            if(!check.checked) { mostrarAlerta("Para continuar, você precisa confirmar que concorda com a regra de 50% de entrada."); const box = document.getElementById('box-termos'); box.style.border = "2px solid #F44336"; box.style.animation = "shake 0.5s"; setTimeout(() => box.style.animation = "none", 500); return false; } return true;
        }

        async function registrarPedido(origem) {
            const nome = document.getElementById('cliente-nome').value;
            const zap = document.getElementById('cliente-zap').value;
            if(!nome || !zap) { mostrarAlerta("Por favor, preencha seu Nome e WhatsApp!"); return null; }
            const id = '#' + Math.random().toString(36).substr(2, 4).toUpperCase();
            try {
                let precoEfetivo = (produtoAtual.em_promocao && produtoAtual.preco_promocional > 0) ? produtoAtual.preco_promocional : produtoAtual.preco;
                let total = precoEfetivo * qtdAtual;
                await addDoc(collection(db, "pedidos"), { id_visual: id, cliente: nome, whatsapp: zap, produto: `${produtoAtual.nome} (x${qtdAtual})`, total: total, data: new Date().toISOString(), status: origem==='Cartão'?'Aguardando Pagamento':'Pendente', origem });
                return id;
            } catch(e) { mostrarAlerta("Erro: " + e.message); return null; }
        }

        window.pagarComCartao = async () => {
            if(!validarTermos()) return;
            const btn = document.getElementById('btn-pagar-link'); btn.innerText = "...";
            const id = await registrarPedido('Cartão');
            if(id) { window.open(produtoAtual.link_pagamento, '_blank'); fecharModal(); document.getElementById('sucesso-id').innerText = id; document.getElementById('modal-sucesso').style.display = 'flex'; }
            btn.innerHTML = '<i class="fas fa-credit-card"></i> Pagar com Cartão';
        }

        window.finalizarPedidoZap = async () => {
            if(!validarTermos()) return;
            const id = await registrarPedido('WhatsApp');
            if(id) {
                const nome = document.getElementById('cliente-nome').value;
                let precoEfetivo = (produtoAtual.em_promocao && produtoAtual.preco_promocional > 0) ? produtoAtual.preco_promocional : produtoAtual.preco;
                let total = precoEfetivo * qtdAtual;
                const msg = `Olá! Sou *${nome}*.\nPedido *${id}*: ${qtdAtual}x *${produtoAtual.nome}*.\nTotal: ${formatarMoeda(total)}.\n\n✅ *Li e concordo com os 50% de entrada.*\nAguardo chave Pix para pagamento.`;
                window.open(`https://wa.me/559292770409?text=${encodeURIComponent(msg)}`, '_blank');
                fecharModal();
            }
        }

        window.fecharSucesso = () => {
            const id = document.getElementById('sucesso-id').innerText;
            const msg = `Paguei o pedido *${id}*. Segue comprovante:`;
            window.open(`https://wa.me/559292770409?text=${encodeURIComponent(msg)}`, '_blank');
            document.getElementById('modal-sucesso').style.display = 'none';
        }

        window.compartilharProduto = async () => {
            if (navigator.share) {
                try { await navigator.share({ title: `Olha que lindo: ${produtoAtual.nome}`, text: `Achei esse ${produtoAtual.nome} na Gabriele Personaliza!`, url: window.location.href }); } 
                catch (err) { console.log('Cancelou compartilhamento'); }
            } else { mostrarAlerta("Link da loja copiado para a área de transferência!"); navigator.clipboard.writeText(window.location.href); }
        }

        document.getElementById('btn-secreto').addEventListener('click', () => { window.location.href = 'admin.html'; });
        document.getElementById('ano-atual').innerText = new Date().getFullYear();
        carregarLoja();
    </script>
</body>
</html>